<!DOCTYPE html>
<html lang="cn">
{%- block html %}
  <head>
    {%- block head %}
    <title>{% block title %}{{title|default}}{% endblock title %}</title>

    {%- block metas %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {%- endblock metas %}

    {%- block styles %}
    <!-- Bootstrap -->
    <link href="{{bootstrap_find_resource('css/bootstrap.css', cdn='bootstrap')}}" rel="stylesheet">

    <style>

        html,body{
            height:100%;
            width:100%;
        }

        .footer{
            bottom:100;
            width:100%;
            height:100px;
            background-color:#333333;
            margin-top: -30px;
        }

        .wrap{
            min-height:100%
        }

        .main{
            padding-bottom:50px;
            overflow:hidden;
        }

        .sidebar{
            position: fixed;
            margin-top:70px;
            height:550px;
            background-color:#fafafa;
            overflow:hidden;
            box-shadow: 0px 0px 2px 2px #f0f0f0;
            min-width:180px;
        }

        .footer-div{
            color:#FFFFFF;
            text-align:center;
            font-size:16px;
            margin-top: 10px;
        }

        .footer-p-firstline{
            margin-top: 10px;
        }

        canvas{
           position: absolute;
           z-index: -1;
        }

        .content-block{
            background-color:#fafafa;
            overflow:hidden;
            box-shadow: 0px 0px 2px 2px #f0f0f0;
            width: 49%;
            margin-top:70px;
            height:1000px;
            min-width:500px;
        }

    </style>

    {%- endblock styles %}
    {%- endblock head %}
  </head>
  <body background="static/img/background.png" background-repeat="repeat">
    {% block body -%}
    {% block navbar %}

    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container text-center">
            <div class="navbar-header">
                <a class="navbar-brand">1000ms的小站</a>
            </div>
            <div class = "navbar-right">
                <form class="navbar-form navbar-left" role="search">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search">
                    </div>
                    <button type="submit" class="btn btn-default">提交按钮</button>
                </form>
                <button type="button" class="btn btn-default navbar-btn">
                    用户
                </button>
            </div>
        </div>
    </nav>

    {%- endblock navbar %}

    <div class="wrap">
        <div class="main">
            <canvas id="c" width="300" height="150"></canvas>
            {% block sidebar -%}
            <div class="sidebar col-md-2 col-md-offset-8">

            </div>
            {%- endblock sidebar %}

            {% block content -%}

            <div class="content-block col-md-6 col-md-offset-2">

            </div>


            {%- endblock content %}
        </div>
    </div>



    {% block footer -%}
        <div class="footer">
              <div class="container footer-div">
                <p class="footer-p-firstline">Designed by Victor Lai</p>
              </div>
        </div>
    {% endblock footer -%}

    {% block scripts %}
    <script src="{{bootstrap_find_resource('jquery.js', cdn='jquery')}}"></script>
    <script src="{{bootstrap_find_resource('js/bootstrap.js', cdn='bootstrap')}}"></script>

    <script>
        $(document).ready(function() {
            var canvas = document.getElementById("c");
            var ctx = canvas.getContext("2d");
            var c = $("#c");
            var w,h;
            var pi = Math.PI;
            var all_attribute = {
                num:20,            			 // 个数
                start_probability:0.01,		     // 如果数量小于num，有这些几率添加一个新的
                radius_min:1,   			     // 初始半径最小值
                radius_max:2,   			     // 初始半径最大值
                radius_add_min:.1,               // 半径增加最小值
                radius_add_max:.5,               // 半径增加最大值
                opacity_min:0.5,                 // 初始透明度最小值
                opacity_max:0.7, 				 // 初始透明度最大值
                opacity_prev_min:.003,            // 透明度递减值最小值
                opacity_prev_max:.005,            // 透明度递减值最大值
                light_min:85,                 // 颜色亮度最小值
                light_max:100,                 // 颜色亮度最大值
            };
            var style_color = 200;
            var all_element =[];
            window_resize();
            function start(){
                window.requestAnimationFrame(start);
                //style_color+=0.1;  颜色变化
                ctx.fillStyle = 'hsl('+style_color+',20%,99.5%)';
                ctx.fillRect(0, 0, w, h);
                if (all_element.length < all_attribute.num && Math.random() < all_attribute.start_probability){
                    all_element.push(new ready_run);
                }
                all_element.map(function(line) {
                    line.to_step();
                })
            }
            function ready_run(){
                this.to_reset();
            }
            ready_run.prototype = {
                to_reset:function(){
                    var t = this;
                    t.x = find_random(0,w);
                    t.y = find_random(0,h);
                    t.radius = find_random(all_attribute.radius_min,all_attribute.radius_max);
                    t.radius_change = find_random(all_attribute.radius_add_min,all_attribute.radius_add_max);
                    t.opacity = find_random(all_attribute.opacity_min,all_attribute.opacity_max);
                    t.opacity_change = find_random(all_attribute.opacity_prev_min,all_attribute.opacity_prev_max);
                    t.light = find_random(all_attribute.light_min,all_attribute.light_max);
                    t.color = 'hsl('+style_color+',50%,'+t.light+'%)';
                },
                to_step:function(){
                    var t = this;
                    t.opacity -= t.opacity_change;
                    t.radius += t.radius_change;
                    if(t.opacity <= 0){
                        t.to_reset();
                        return false;
                    }
                    ctx.fillStyle = t.color;
                    ctx.globalAlpha = t.opacity;
                    ctx.beginPath();
                    ctx.arc(t.x,t.y,t.radius,0,2*pi,true);
                    ctx.closePath();
                    ctx.fill();
                    ctx.globalAlpha = 1;
                }
            }
            function window_resize(){
                w = window.innerWidth;
                h = $(".main").outerHeight(true);
                canvas.width = w;
                canvas.height = h;
            }
            $(window).resize(function(){
                window_resize();
            });
            function find_random(num_one,num_two){
                return Math.random()*(num_two-num_one)+num_one;
            }
            (function() {
                var lastTime = 0;
                var vendors = ['webkit', 'moz'];
                for(var xx = 0; xx < vendors.length && !window.requestAnimationFrame; ++xx) {
                    window.requestAnimationFrame = window[vendors[xx] + 'RequestAnimationFrame'];
                    window.cancelAnimationFrame = window[vendors[xx] + 'CancelAnimationFrame'] ||
                                                  window[vendors[xx] + 'CancelRequestAnimationFrame'];
                }

                if (!window.requestAnimationFrame) {
                    window.requestAnimationFrame = function(callback, element) {
                        var currTime = new Date().getTime();
                        var timeToCall = Math.max(0, 16.7 - (currTime - lastTime));
                        var id = window.setTimeout(function() {
                            callback(currTime + timeToCall);
                        }, timeToCall);
                        lastTime = currTime + timeToCall;
                        return id;
                    };
                }
                if (!window.cancelAnimationFrame) {
                    window.cancelAnimationFrame = function(id) {
                        clearTimeout(id);
                    };
                }
            }());
            start();
        });

    </script>

    {%- endblock scripts %}
    {%- endblock body %}
  </body>
{%- endblock html %}
</html>