{% extends "__base__.html" %}
{% import "bootstrap/wtf.html" as wtf %}

{% block title %} 设置头像 {% endblock title %}

{% block center_bar %}

<div>
{{ wtf.quick_form(form)}}
</div>

<button id="btn1">提交</button>

{% endblock center_bar %}

{% block other_scripts %}
<script>
    $(document).ready(function() {
        document.getElementById('btn1').addEventListener('click', function () {
            //检测图片格式和大小后再上传
            var img = $('#profilephoto')[0].files[0]
            if(!img){
                alert("请选择图片")
            }else{
                var img_name = $('#profilephoto').val()
                var index= img_name.lastIndexOf(".")
                img_id=img_name.substring(index);
                if(img_id!=".bmp"&&img_id!=".png"&&img_id!=".gif"&&img_id!=".jpg"&&img_id!=".jpeg"){
                    alert("图片格式有误，请重新选择")
                    $('#profilephoto').val('')
                }else if(img.size > 1024*1024*1){
                    alert("图片大于1M，请重新选择")
                    $('#profilephoto').val('')
                }else{
                    var formData = new FormData()
                    formData.append('profilephoto', img)
                    $.ajax({
                           url : '{{url_for('img.get_profile_photo')}}',
                           type : 'POST',
                           data : formData,
                           processData: false,  // tell jQuery not to process the data
                           contentType: false,  // tell jQuery not to set contentType
                           success : function(data) {
                               alert("提交成功")
                           }
                    })
                }
            }
        })
    })
</script>
{% endblock other_scripts %}