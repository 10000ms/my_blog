{% extends "__base__.html" %}
{% import "__macros__.html" as macros %}

{% block title %} 文章管理 {% endblock title %}

{% block other_styles %}
<style>
    .center-div{
        margin-top:70px;
        min-height:800px;
        padding:15px;
        background-color:#fafafa;
        overflow:hidden;
        box-shadow: 0px 0px 2px 2px #f0f0f0;
        min-width:500px;
        border-radius: 5px;
    }
    .return{
        width:80px;
        height:40px;
        font-size: 16px;
        width:80px;
        color:#808080;
        margin-bottom:20px;
    }
    .return-a{
        font-family: 'Microsoft YaHei';
        color:#808080;
        letter-spacing:5px;
        font-weight:600;
    }
    .search-div{
        border-top-style:solid;
        border-top-width:2px;
        border-top-color: #FFFFFF;
        border-bottom-style:solid;
        border-bottom-width:2px;
        border-bottom-color: #FFFFFF;
        padding:20px;
        margin-bottom:20px;
    }
    .div-word{
        font-family: 'Microsoft YaHei';
        color:#808080;
        letter-spacing:2px;
        font-weight:600;
    }
    .table-div{
        padding:20px;
        font-family: 'Microsoft YaHei';
        color:#808080;
        letter-spacing:2px;
    }
    .pagination-div{
        color:#808080;
        margin-left:auto;
        margin-right:auto;
        text-align:center;
    }
</style>
{% endblock other_styles %}

{% block content %}
<div class="center-div col-md-8 col-md-offset-2">
    <button  type="button" class="btn btn-default return">
            <a href="{{url_for('admin.admin_index_page')}}" class="return-a">
                返回
            </a>
    </button>
    <div class="search-div">
        <p class="div-word">按文章标题搜索文章:</p>
        <form method="post" action="{{url_for('article.search_article_page')}}">
            <div class="input-group">
                <input type="text" class="form-control" name="name" placeholder="搜索">
                <span class="input-group-btn">
                    <button class="btn btn-default" type="submit"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                </span>
            </div>
        </form>
    </div>
    <div class="table-div">
        <table class="table table-striped">
            <tr>
                <th>文章名</th>
                <th>作者</th>
                <th>创建时间</th>
                <th>关键字</th>
                <th>描述</th>
                <th>操作</th>
            </tr>
            {% for article in items %}
            <tr>
                <td>{{article.title}}</td>
                <td>{{article.user.username}}</td>
                <td>{{article.create_datetime}}</td>
                <td>{{article.keyword}}</td>
                <td>{{article.description}}</td>
                <td>
                    <button type="button" class="btn btn-default">
                        <a href="{{url_for('article.article_detail_page', article_id = article.id)}}">
                            查看本文
                        </a>
                    </button>
                    <button type="button" class="btn btn-default">
                        <a href="{{url_for('article.change_article_page', article_id = article.id)}}">
                            修改
                        </a>
                    </button>
                    <button type="button" class="btn btn-default delete-button" id="{{url_for('article.delete_article_page',article_id = article.id)}}">
                            删除
                    </button>
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>

    {% if pagination and need_pagination !=0 %}
    <div class="pagination-div">
        <div class="pagination">
            {{ macros.pagination_widget(pagination, pagination_url) }}
        </div>
    </div>
    {% endif %}
</div>
{% endblock content %}

{% block other_scripts %}
    <script>
        $(document).ready(function() {
            var delete_button = document.getElementsByClassName('delete-button')
            for (i = 0; i < delete_button.length; i++) {
                delete_button[i].addEventListener('click', function () {
                    var url = event.target.id
                    jQuery.post(url=url, function(data) {
                        alert(data)
                        window.location.href = '{{url_for('article.manage_article_page')}}'
                    })
                })
            }
        })
    </script>
{% endblock other_scripts %}